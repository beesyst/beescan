<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>SecWebScan Report</title>
    {% if report_theme == "dark" %}
    <link rel="stylesheet" href="../templates/css/style_dark.css">
    {% else %}
    <link rel="stylesheet" href="../templates/css/style_light.css">
    {% endif %}
</head>

<body>
    <h1>SecWebScan Report</h1>

    {% for target, categories in structured_results.items() %}
    <div class="module">
        <p><strong>Target:</strong> {{ target }}</p>
        <p><strong>Other addresses:</strong>
            {{ categories["__meta__"].mac if categories.get("__meta__") and categories["__meta__"].mac else "Unknown" }}
        </p>
        <p><strong>Time:</strong>
            {{ categories["__meta__"].created_at if categories.get("__meta__") and categories["__meta__"].created_at
            else "Unknown" }}
        </p>

        {% for category, subcats in categories.items() %}
        {% if category != "__meta__" %}
        <h2>{{ category }}</h2>
        {% for subcategory, entries in subcats.items() %}
        {% if entries and entries[0]["data"] is iterable and entries[0]["data"] is not string and entries[0]["data"][0]
        is mapping %}
        <h3>{{ subcategory }}</h3>

        {% set exclude_keys = ["source", "severity", "created_at", "module"] %}

        {% if entries[0]["module"] == "nikto" %}
        <table>
            <thead>
                <tr>
                    <th>URI</th>
                    <th>Message</th>
                </tr>
            </thead>
            <tbody>
                {% for row in entries[0]["data"] %}
                <tr>
                    <td>{{ row.uri or "-" }}</td>
                    <td>{{ row.message or "-" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <table>
            <thead>
                <tr>
                    {% for key in entries[0]["data"][0].keys() if key not in exclude_keys %}
                    <th>{{ key.replace('_', ' ') | title }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in entries[0]["data"] %}
                <tr>
                    {% for key, val in row.items() if key not in exclude_keys %}
                    <td>{{ val if val else "-" }}</td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
        {% else %}
        <h3>{{ subcategory }}</h3>
        <pre>{{ entries[0]["data"] }}</pre>
        {% endif %}
        {% endfor %}
        {% endif %}
        {% endfor %}
    </div>
    {% endfor %}

    <div class="footer">
        Generated by SecWebScan | {{ generation_time }}
    </div>
</body>

</html>